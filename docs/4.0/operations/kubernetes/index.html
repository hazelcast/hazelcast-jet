<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Jet on Kubernetes · Hazelcast Jet</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Using Kubernetes for orchestrating Jet clusters."/><meta name="docsearch:version" content="4.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Jet on Kubernetes · Hazelcast Jet"/><meta property="og:type" content="website"/><meta property="og:url" content="https://jet-start.sh/"/><meta property="og:description" content="Using Kubernetes for orchestrating Jet clusters."/><meta property="og:image" content="https://jet-start.sh/img/Hazelcast-Jet-Logo-Blue_Dark.jpg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://jet-start.sh/img/Hazelcast-Jet-Logo-Blue_Dark.jpg"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://jet-start.sh/blog/atom.xml" title="Hazelcast Jet Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://jet-start.sh/blog/feed.xml" title="Hazelcast Jet Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-158279495-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,600"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500,600,700,800"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="https://plausible.io/js/plausible.js" async="" defer="" data-domain="jet-start.sh"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-dark.svg" alt="Hazelcast Jet"/></a><a href="/versions"><h3>4.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/4.0/get-started/intro" target="_self">Docs</a></li><li class=""><a href="/download" target="_self">Download</a></li><li class=""><a href="/demos" target="_self">Demos</a></li><li class=""><a href="https://github.com/hazelcast/hazelcast-jet" target="_self">GitHub</a></li><li class=""><a href="https://slack.hazelcast.com/" target="_self">Community</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Operations Guide</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Get Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/get-started/intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/get-started/first-job">Your First Jet Program</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/get-started/installation">Set Up a Jet Cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/get-started/submit-job">Submit a Job to the Cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/get-started/scale-job">Scale Your Job</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/tutorials/kafka">Process Events from Apache Kafka</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/tutorials/cdc">Change Data Capture from MySQL</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/tutorials/map-join">Enrich Your Stream</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/tutorials/windowing">Apply Windowed Aggregation</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/tutorials/python">Apply a Python Function</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/concepts/dag">Directed Acyclic Graph (DAG)</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/concepts/event-time">Streaming and Event Time</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/concepts/processing-guarantees">Processing Guarantees for Stateful Computation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Programming Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/api/pipeline">Building Pipelines</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/stateless-transforms">Stateless Transforms</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/stateful-transforms">Stateful Transforms</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/sources-sinks">Sources and Sinks</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/submitting-jobs">Submitting Jobs</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/data-structures">Distributed Data Structures</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/serialization">Serialization</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/testing">Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/api/spring">Spring Integration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">How-To Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/how-tos/stream-imap">Receive IMap Change Stream</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/how-tos/observables">Receive Results on the Client</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/how-tos/custom-batch-source">Create a Batch Source</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/how-tos/custom-stream-source">Create a Streaming Source</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/how-tos/custom-sink">Create a Sink</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/how-tos/xa">Compatibility of XA Support</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Operations Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/discovery">Cluster Discovery</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/cluster-sizing">Cluster Sizing</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/job-management">Job Management</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/4.0/operations/kubernetes">Jet on Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/monitoring">Monitoring and Metrics</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/operations/version-compatibility">Version Compatibility</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/distributed-computing">Pipeline Execution Model</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/execution-engine">Cooperative Multithreading</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/cluster-topology">Cluster Topology</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/event-time-processing">Event Time-Based Processing</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/sliding-window">Sliding Window Aggregation</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/fault-tolerance">Fault Tolerance</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/architecture/in-memory-storage">In-Memory Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Design Documents<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/4.0/design-docs/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/design-docs/002-job-level-serialization">002 - Job-level Serialization</a></li><li class="navListItem"><a class="navItem" href="/docs/4.0/design-docs/001-code-deployment-improvements">001 - Code Deployment Improvements</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/hazelcast/hazelcast-jet/edit/master/site/docs/operations/kubernetes.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Jet on Kubernetes</h1></header><article><div><span><p>Hazelcast Jet has built-in support for Kubernetes deployments. It only
takes a few configuration parameters to make Hazelcast Jet cluster in
Kubernetes environments. Official Helm packages are also available to
bootstrap Hazelcast Jet deployments with a single command.</p>
<h2><a class="anchor" aria-hidden="true" id="install-using-helm"></a><a href="#install-using-helm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install using Helm</h2>
<p>The easiest way to install Hazelcast Jet on Kubernetes is using Helm
charts, Hazelcast Jet provides stable Helm charts for open-source and
enterprise versions also for Hazelcast Jet Management Center.</p>
<h3><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h3>
<ul>
<li>Kubernetes 1.9+</li>
<li>Helm CLI</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="installing-the-chart"></a><a href="#installing-the-chart" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installing the Chart</h3>
<p>You can install the latest version with default configuration values
using below command:</p>
<pre><code class="hljs css language-bash">helm install my-cluster stable/hazelcast-jet
</code></pre>
<p>This will create a cluster with the name <code>my-cluster</code> and with default
configuration values. To change various configuration options you can
use <code>–set key=value</code>:</p>
<pre><code class="hljs css language-bash">helm install my-cluster --<span class="hljs-built_in">set</span> cluster.memberCount=3 stable/hazelcast-jet
</code></pre>
<p>Or you can create a <code>values.yaml</code> file which contains custom
configuration options. This file may contain custom <code>hazelcast</code> and
<code>hazelcast-jet</code> yaml files in it too.</p>
<pre><code class="hljs css language-bash">helm install my-cluster -f values.yaml stable/hazelcast-jet
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="uninstalling-the-chart"></a><a href="#uninstalling-the-chart" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uninstalling the Chart</h3>
<p>To uninstall/delete the <code>my-release</code> deployment:</p>
<pre><code class="hljs css language-bash">helm uninstall my-release
</code></pre>
<p>The command removes all the Kubernetes components associated with the
chart and deletes the release.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<p>The following table lists some of the configurable parameters of the
Hazelcast Jet chart and their default values.</p>
<table>
<thead>
<tr><th style="text-align:left">Parameter</th><th style="text-align:left">Description</th><th style="text-align:left">Default</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>image.repository</code></td><td style="text-align:left">Hazelcast Jet Image name</td><td style="text-align:left"><code>hazelcast/hazelcast-jet</code></td></tr>
<tr><td style="text-align:left"><code>image.tag</code></td><td style="text-align:left">Hazelcast Jet Image tag</td><td style="text-align:left">{VERSION}</td></tr>
<tr><td style="text-align:left"><code>cluster.memberCount</code></td><td style="text-align:left">Number of Hazelcast Jet members</td><td style="text-align:left">2</td></tr>
<tr><td style="text-align:left"><code>jet.yaml.hazelcast-jet</code></td><td style="text-align:left">Hazelcast Jet Configuration (<code>hazelcast-jet.yaml</code> embedded into <code>values.yaml</code>)</td><td style="text-align:left"><code>{DEFAULT_JET_YAML}</code></td></tr>
<tr><td style="text-align:left"><code>jet.yaml.hazelcast</code></td><td style="text-align:left">Hazelcast IMDG Configuration (<code>hazelcast.yaml</code> embedded into <code>values.yaml</code>)</td><td style="text-align:left"><code>{DEFAULT_HAZELCAST_YAML}</code></td></tr>
<tr><td style="text-align:left"><code>managementcenter.enabled</code></td><td style="text-align:left">Turn on and off Hazelcast Jet Management Center application</td><td style="text-align:left"><code>true</code></td></tr>
</tbody>
</table>
<p>See
<a href="https://github.com/helm/charts/tree/master/stable/hazelcast-jet">stable charts repository</a>
for more information and configuration options.</p>
<h2><a class="anchor" aria-hidden="true" id="install-without-helm"></a><a href="#install-without-helm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install without Helm</h2>
<p>Hazelcast Jet provides Kubernetes-ready Docker images, these images use
the Hazelcast Kubernetes plugin to discover other Hazelcast Jet members
by interacting with the Kubernetes APIs. See <a href="discovery#kubernetes">relevant</a>
section for more details.</p>
<h3><a class="anchor" aria-hidden="true" id="role-based-access-control"></a><a href="#role-based-access-control" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Role Based Access Control</h3>
<p>To communicate with the Kubernetes APIs, create the Role
Based Access Control definition, (<code>rbac.yaml</code>), with the following
content and apply it:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">default-cluster</span>
<span class="hljs-attr">roleRef:</span>
  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span>
  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">view</span>
<span class="hljs-attr">subjects:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">default</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span>
</code></pre>
<pre><code class="hljs css language-bash">kubectl apply -f rbac.yaml
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="configmap"></a><a href="#configmap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ConfigMap</h3>
<p>Then we need to configure Hazelcast Jet to use Kubernetes Discovery to
form the cluster. Create a file named <code>hazelcast-jet-config.yaml</code> with
following content and apply it. This will create a ConfigMap object.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-configuration</span>
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">hazelcast.yaml:</span> <span class="hljs-string">|-
    hazelcast:
      network:
        join:
          multicast:
            enabled: false
          kubernetes:
            enabled: true
            namespace: default
            service-name: hazelcast-jet-service
        rest-api:
          enabled: true
          endpoint-groups:
            HEALTH_CHECK:
              enabled: true
</span></code></pre>
<pre><code class="hljs css language-bash">kubectl apply -f hazelcast-jet-config.yaml
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="statefulset-and-service"></a><a href="#statefulset-and-service" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>StatefulSet and Service</h3>
<p>Now we need to create a <em>StatefulSet</em> and a <em>Service</em> which defines the
container spec. You can configure the environment options and the
cluster size here. Create a file named <code>hazelcast-jet.yaml</code> with
following content and apply it.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">hazelcast-jet</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">serviceName:</span> <span class="hljs-string">hazelcast-jet-service</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">hazelcast-jet</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">hazelcast-jet</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">hazelcast/hazelcast-jet:latest</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet</span>
          <span class="hljs-attr">containerPort:</span> <span class="hljs-number">5701</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/hazelcast/health/node-state</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">5701</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span>
          <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">1</span>
          <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/hazelcast/health/node-state</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">5701</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">1</span>
          <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">1</span>
          <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">volumeMounts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-storage</span>
          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/data/hazelcast-jet</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">JAVA_OPTS</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"-Dhazelcast.config=/data/hazelcast-jet/hazelcast.yaml"</span>
      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-storage</span>
        <span class="hljs-attr">configMap:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-configuration</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">hazelcast-jet</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5701</span>
</code></pre>
<pre><code class="hljs css language-bash">kubectl apply -f hazelcast-jet.yaml
</code></pre>
<p>After deploying it, we can check the status of pods with the following
command:</p>
<pre><code class="hljs css language-bash">$ kubectl get pods
NAME              READY   STATUS    RESTARTS   AGE
hazelcast-jet-0   1/1     Running   0          2m23s
hazelcast-jet-1   1/1     Running   0          103s
</code></pre>
<p>Then we can verify from the logs of the pods that they formed a cluster
with the following command:</p>
<pre><code class="hljs css language-log">$ kubectl logs hazelcast-jet<span class="hljs-number">-0</span>
...
...
...
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-05</span> <span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">44</span>,<span class="hljs-number">698</span>  INFO [c.h.i.c.ClusterService] [main] - [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> [dev] [<span class="hljs-number">4.0</span>]

Members {size:<span class="hljs-number">1</span>, ver:<span class="hljs-number">1</span>} [
 Member [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> - <span class="hljs-number">03</span>a22d3c-d88a<span class="hljs-number">-40</span>bf<span class="hljs-number">-81</span>b0<span class="hljs-number">-8f</span>85e16acb0f <span class="hljs-keyword">this</span>
]

<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-05</span> <span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">44</span>,<span class="hljs-number">725</span>  INFO [c.h.c.LifecycleService] [main] - [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> [dev] [<span class="hljs-number">4.0</span>] [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> <span class="hljs-keyword">is</span> STARTED
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-05</span> <span class="hljs-number">10</span>:<span class="hljs-number">03</span>:<span class="hljs-number">20</span>,<span class="hljs-number">387</span>  INFO [c.h.i.n.t.TcpIpConnection] [hz.distracted_bartik.IO.thread-<span class="hljs-keyword">in</span><span class="hljs-number">-2</span>] - [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> [dev] [<span class="hljs-number">4.0</span>] Initialized new cluster connection between /<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>:<span class="hljs-number">5701</span> <span class="hljs-keyword">and</span> /<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.7</span>:<span class="hljs-number">49103</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-05</span> <span class="hljs-number">10</span>:<span class="hljs-number">03</span>:<span class="hljs-number">27</span>,<span class="hljs-number">381</span>  INFO [c.h.i.c.ClusterService] [hz.distracted_bartik.priority-generic-operation.thread<span class="hljs-number">-0</span>] - [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> [dev] [<span class="hljs-number">4.0</span>]

Members {size:<span class="hljs-number">2</span>, ver:<span class="hljs-number">2</span>} [
 Member [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.6</span>]:<span class="hljs-number">5701</span> - <span class="hljs-number">03</span>a22d3c-d88a<span class="hljs-number">-40</span>bf<span class="hljs-number">-81</span>b0<span class="hljs-number">-8f</span>85e16acb0f <span class="hljs-keyword">this</span>
 Member [<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.7</span>]:<span class="hljs-number">5701</span> - a7295b91<span class="hljs-number">-939</span>b<span class="hljs-number">-4181</span>-acae<span class="hljs-number">-208145f</span>773e6
]
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="deploy-jobs"></a><a href="#deploy-jobs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploy Jobs</h2>
<p>There are two different ways to submit a job to a Hazelcast Jet cluster:</p>
<ul>
<li>Package Job as a Docker container then let it submit itself.</li>
<li>Submit Job as a JAR file from a shared <code>PersistentVolume</code> which is
attached to a Pod.</li>
</ul>
<p>For both options you need to create a <code>ConfigMap</code> object for the client
(<code>hazelcast-jet-client-config.yaml</code>) and apply it. Make sure that the
service-name is pointing to the service-name of the cluster we have
created above.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-client-configuration</span>
<span class="hljs-attr">data:</span>
  <span class="hljs-attr">hazelcast-client.yaml:</span> <span class="hljs-string">|-
    hazelcast-client:
      cluster-name: jet
      network:
        kubernetes:
          enabled: true
          namespace: default
          service-name: hazelcast-jet-service
</span></code></pre>
<pre><code class="hljs css language-bash">kubectl apply -f hazelcast-jet-client-config.yaml
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="package-the-job-as-a-docker-container"></a><a href="#package-the-job-as-a-docker-container" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Package the Job as a Docker Container</h3>
<p>There are several tools to containerize your job, for example
<a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin">Jib</a>.
Jib builds Docker and OCI images for Java applications. It is available
as plugins for Maven and Gradle and as a Java library. You can find a
<a href="https://github.com/hazelcast/hazelcast-jet-docker/tree/master/examples/kubernetes#steps-to-package-the-job-as-a-docker-container">sample-project</a>
using Jib to containerize the Hazelcast Jet rolling-aggregate job.</p>
<p>After creating the image, we create a <em>Kubernetes Job</em> using the image
and client ConfigMap object. The client config is stored in a volume,
mounted to the container and passed as an argument to the <code>jet submit</code>
script along with the name of the JAR containing the Jet job.</p>
<p>Create a file named <code>rolling-aggregation-via-docker.yaml</code> and apply it.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">rolling-aggregation:latest</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
        <span class="hljs-attr">command:</span> <span class="hljs-string">["/bin/sh"]</span>
        <span class="hljs-attr">args:</span> <span class="hljs-string">["-c",</span> <span class="hljs-string">"jet -v -f /config/hazelcast-jet/hazelcast-client.yaml submit /rolling-aggregation-jar-with-dependencies.jar"</span><span class="hljs-string">]</span>
        <span class="hljs-attr">volumeMounts:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">"/config/hazelcast-jet/"</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-config-storage</span>
      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-config-storage</span>
        <span class="hljs-attr">configMap:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-client-configuration</span>
          <span class="hljs-attr">items:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">hazelcast-client.yaml</span>
              <span class="hljs-attr">path:</span> <span class="hljs-string">hazelcast-client.yaml</span>
      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span>
</code></pre>
<pre><code class="hljs css language-bash">kubectl apply -f rolling-aggregation-via-docker.yaml
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="submit-the-job-from-a-shared-persistent-volume"></a><a href="#submit-the-job-from-a-shared-persistent-volume" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submit the Job from a Shared Persistent Volume</h3>
<p>We will need a persistent volume attached to the Pods. The persistent
storage will contain job JAR files to be submitted to the cluster. There
are many different ways you can define and map volumes in Kubernetes. We
will create <code>hostPath</code> persistent volume, which mounts a file or directory
from the host node’s filesystem into the Pod. See
<a href="https://kubernetes.io/docs/concepts/storage/volumes/">official documentation</a>
for other types of volumes.</p>
<p>Create a file named <code>persistent-volume.yaml</code> and apply it:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolume</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation-pv</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">local</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">manual</span>
  <span class="hljs-attr">capacity:</span>
    <span class="hljs-attr">storage:</span> <span class="hljs-string">2Gi</span>
  <span class="hljs-attr">accessModes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteOnce</span>
  <span class="hljs-attr">hostPath:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">"/home/docker/jars-pv"</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">PersistentVolumeClaim</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation-pv-claim</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">manual</span>
  <span class="hljs-attr">accessModes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteOnce</span>
  <span class="hljs-attr">resources:</span>
    <span class="hljs-attr">requests:</span>
      <span class="hljs-attr">storage:</span> <span class="hljs-string">1Gi</span>
</code></pre>
<p>This will create a persistent volume which will use the
<code>/home/docker/jars-pv</code> directory as persistent volume on the kubernetes
node. We will mount the volume to the Pods later. So we need to put the
job JAR inside this directory.</p>
<p>For <code>minikube</code> below commands will create the directory and copy the job
JAR into it.</p>
<pre><code class="hljs css language-bash">ssh docker@$(minikube ip) -i $(minikube ssh-key) <span class="hljs-string">'mkdir -p ~/jars-pv'</span>
scp -i $(minikube ssh-key) rolling-aggregation-jar-with-dependencies.jar docker@$(minikube ip):~/jars-pv/
</code></pre>
<p>Now we can create the <em>Kubernetes Job</em> using Hazelcast Jet image and
client ConfigMap object. The client config and the copied job JAR is
stored in respective volumes, mounted to the container and passed as an
argument to the <code>jet submit</code> script.</p>
<p>Create a file named <code>rolling-aggregation.yaml</code> and apply it.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">hazelcast/hazelcast-jet:latest-snapshot</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
        <span class="hljs-attr">command:</span> <span class="hljs-string">["/bin/sh"]</span>
        <span class="hljs-attr">args:</span> <span class="hljs-string">["-c",</span> <span class="hljs-string">"jet.sh -v -f /data/hazelcast-jet/hazelcast-client.yaml submit /job-jars/rolling-aggregation-jar-with-dependencies.jar"</span><span class="hljs-string">]</span>
        <span class="hljs-attr">volumeMounts:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">"/job-jars"</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation-pv-storage</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">"/data/hazelcast-jet/"</span>
            <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-config-storage</span>
      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rolling-aggregation-pv-storage</span>
        <span class="hljs-attr">persistentVolumeClaim:</span>
          <span class="hljs-attr">claimName:</span> <span class="hljs-string">rolling-aggregation-pv-claim</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-config-storage</span>
        <span class="hljs-attr">configMap:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">hazelcast-jet-client-configuration</span>
          <span class="hljs-attr">items:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">hazelcast-client.yaml</span>
              <span class="hljs-attr">path:</span> <span class="hljs-string">hazelcast-client.yaml</span>
      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span>
  <span class="hljs-attr">backoffLimit:</span> <span class="hljs-number">4</span>
</code></pre>
<pre><code class="hljs css language-bash">kubectl apply -f rolling-aggregation.yaml
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="inspect-jobs"></a><a href="#inspect-jobs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inspect Jobs</h2>
<p>After you've run the job, you can open up Kubernetes Dashboard to see
it's status. To open Kubernetes Dashboard on <code>minikube</code> run the
following command:</p>
<pre><code class="hljs css language-bash">minikube dashboard
</code></pre>
<p>This will open a browser window with the Kubernetes Dashboard. Then
navigate to <em>Jobs</em> section on left menu. You should be able to see your
job running/completed successfully like below and inspect the logs if
you like.</p>
<p><img src="/docs/assets/minikube-dashboard.png" alt="minikube-dashboard"></p>
<h2><a class="anchor" aria-hidden="true" id="access-from-outside-the-kubernetes"></a><a href="#access-from-outside-the-kubernetes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Access From Outside The Kubernetes</h2>
<p>While it is straightforward to access the Hazelcast Jet cluster inside
the Kubernetes (see <a href="#deploy-jobs">Deploy Jobs</a> for a sample client
config), it is only possible with the public Internet network if you are
accessing the cluster from outside.</p>
<h3><a class="anchor" aria-hidden="true" id="smart-routing-disabled"></a><a href="#smart-routing-disabled" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Smart Routing Disabled</h3>
<p>If you configure <code>smart-routing: false</code> for your client, you don't need
any plugin. It's enough to expose your Hazelcast Jet cluster with a
LoadBalancer (or NodePort) service and set its IP/port as the TCP/IP
Hazelcast Jet Client configuration. Remember that if smart-routing is
disabled then all the communication happens against a single Hazelcast
Jet member.</p>
<h3><a class="anchor" aria-hidden="true" id="smart-routing-enabled"></a><a href="#smart-routing-enabled" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Smart Routing Enabled</h3>
<p>To access a Hazelcast Jet cluster with a <em>smart</em> client you need to
perform the following steps:</p>
<ul>
<li>Expose each Hazelcast Jet Member Pod with a separate LoadBalancer or
NodePort service (the simplest way to do it is to install
<a href="https://metacontroller.app/">Metacontroller</a> and
<a href="https://github.com/GoogleCloudPlatform/metacontroller/tree/master/examples/service-per-pod">service-per-pod</a>
Decorator Controller)</li>
<li>Configure ServiceAccount with ClusterRole having at least <code>get</code> and
<code>list</code> permissions to the following resources: <code>endpoints</code>, <code>pods</code>,
<code>nodes</code>, <code>services</code></li>
<li>Use credentials from the created ServiceAccount in the Hazelcast Jet
Client configuration (credentials can be fetched with: <code>kubectl get secret &lt;service-account-secret&gt; -o jsonpath={.data.token} | base64 --decode</code> and <code>kubectl get secret &lt;service-account-secret&gt; -o jsonpath={.data.ca\\.crt} | base64 --decode</code>)</li>
</ul>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">hazelcast-client:</span>
  <span class="hljs-attr">network:</span>
    <span class="hljs-attr">kubernetes:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">namespace:</span> <span class="hljs-string">MY-KUBERNETES-NAMESPACE</span>
      <span class="hljs-attr">service-name:</span> <span class="hljs-string">MY-SERVICE-NAME</span>
      <span class="hljs-attr">use-public-ip:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">kubernetes-master:</span> <span class="hljs-string">https://35.226.182.228</span>
      <span class="hljs-attr">api-token:</span> <span class="hljs-string">THE-API-TOKEN</span>
      <span class="hljs-attr">ca-certificate:</span> <span class="hljs-string">|
        -----BEGIN CERTIFICATE-----
        ...
        -----END CERTIFICATE-----
</span></code></pre>
<p><strong>Note</strong>: Hazelcast Jet Client outside Kubernetes cluster works only in
the <em>Kubernetes API</em> mode.</p>
<h2><a class="anchor" aria-hidden="true" id="rolling-update-and-scaling"></a><a href="#rolling-update-and-scaling" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rolling Update and Scaling</h2>
<p>Hazelcast Jet cluster is easily scalable within Kubernetes. You can use
the standard <code>kubectl scale</code> command to change the cluster size. The
same applies the rolling update procedure, you can depend on the
standard Kubernetes behavior and just update the new version to your
<code>Deployment/StatefulSet</code> configurations.</p>
<p>Note however that, by default, Hazelcast Jet does not shutdown
gracefully. It means that if you suddenly terminate more than your
backup-count property (1 by default), you may lose the cluster data. To
prevent that from happening, set the following properties:</p>
<ul>
<li><code>terminationGracePeriodSeconds</code>: In your <code>StatefulSet/Deployment</code>
configuration; the value should be high enough to cover the data
migration process</li>
<li><code>-Dhazelcast.shutdownhook.policy=GRACEFUL</code>: In the JVM parameters</li>
<li><code>-Dhazelcast.graceful.shutdown.max.wait</code>: In the JVM parameters; the
value should be high enough to cover the data migration process</li>
</ul>
<p>Additionally if you use Deployment (not StatefulSet), you need to set
your strategy to
<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment">RollingUpdate</a>
and ensure Pods are updated one by one.</p>
<p>All these features are already included in Hazelcast Jet Helm Charts.
See
<a href="#install-hazelcast-jet-using-helm">Install Hazelcast Jet using Helm</a>
for more information.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/4.0/operations/job-management"><span class="arrow-prev">← </span><span>Job Management</span></a><a class="docs-next button" href="/docs/4.0/operations/monitoring"><span>Monitoring and Metrics</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#install-using-helm">Install using Helm</a><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#installing-the-chart">Installing the Chart</a></li><li><a href="#uninstalling-the-chart">Uninstalling the Chart</a></li><li><a href="#configuration">Configuration</a></li></ul></li><li><a href="#install-without-helm">Install without Helm</a><ul class="toc-headings"><li><a href="#role-based-access-control">Role Based Access Control</a></li><li><a href="#configmap">ConfigMap</a></li><li><a href="#statefulset-and-service">StatefulSet and Service</a></li></ul></li><li><a href="#deploy-jobs">Deploy Jobs</a><ul class="toc-headings"><li><a href="#package-the-job-as-a-docker-container">Package the Job as a Docker Container</a></li><li><a href="#submit-the-job-from-a-shared-persistent-volume">Submit the Job from a Shared Persistent Volume</a></li></ul></li><li><a href="#inspect-jobs">Inspect Jobs</a></li><li><a href="#access-from-outside-the-kubernetes">Access From Outside The Kubernetes</a><ul class="toc-headings"><li><a href="#smart-routing-disabled">Smart Routing Disabled</a></li><li><a href="#smart-routing-enabled">Smart Routing Enabled</a></li></ul></li><li><a href="#rolling-update-and-scaling">Rolling Update and Scaling</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div style="text-align:left"><a href="/" class="nav-home"><img src="/img/logo-light.svg" alt="Hazelcast Jet" width="200" height="40"/></a><div style="margin-left:12px"><a class="github-button" href="https://github.com/hazelcast/hazelcast-jet" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star On GitHub</a></div></div><div><h5>Docs</h5><a href="/docs/get-started/intro">Get Started</a><a href="/docs/concepts/dag">Concepts</a><a href="/docs/tutorials/kafka">Tutorials</a><a href="/docs/architecture/distributed-computing">Architecture</a><a href="/docs/operations/installation">Operations Guide</a><a href="/docs/enterprise">Enterprise Edition</a></div><div><h5>Community</h5><a href="https://groups.google.com/forum/#!forum/hazelcast-jet" target="_blank" rel="noreferrer noopener">Google Groups</a><a href="http://stackoverflow.com/questions/tagged/hazelcast-jet" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://slack.hazelcast.com">Slack</a></div><div><h5>Latest From the Blog</h5><a href="/blog/2021/02/03/jet-44-is-released">Jet 4.4 Released</a><a href="/blog/2020/10/23/jet-43-is-released">Jet 4.3 Released</a><a href="/blog/2020/10/06/enabling-full-text-search">Enabling Full-text Search with Change Data Capture in a Legacy Application</a><a href="/blog/2020/09/18/cdc-meets-stream-processing">Change Data Capture meets Stream Processing</a><a href="/blog/2020/08/05/gc-tuning-for-jet">Sub-10 ms Latency in Java: Concurrent GC with Green Threads</a></div><div><h5>More</h5><a href="https://github.com/hazelcast/hazelcast-jet">GitHub Project</a><a href="http://hazelcast.com/company/careers/">Work at Hazelcast</a><a href="/license">License</a></div></section><section class="copyright">Copyright © 2021 Hazelcast Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '79d1e4941621b9fd761d279d4d19ed69',
                indexName: 'hazelcast-jet',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:en","version:4.0"]}
              });
            </script></body></html>