<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_162) on Tue Feb 04 07:42:40 UTC 2020 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>MigrationAwareService (hazelcast-jet-distribution 3.2.2 API)</title>
<meta name="date" content="2020-02-04">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="MigrationAwareService (hazelcast-jet-distribution 3.2.2 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6,"i2":6,"i3":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MigrationAwareService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/hazelcast/spi/MembershipServiceEvent.html" title="class in com.hazelcast.spi"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../com/hazelcast/spi/NamedOperation.html" title="interface in com.hazelcast.spi"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/hazelcast/spi/MigrationAwareService.html" target="_top">Frames</a></li>
<li><a href="MigrationAwareService.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.hazelcast.spi</div>
<h2 title="Interface MigrationAwareService" class="title">Interface MigrationAwareService</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Subinterfaces:</dt>
<dd><a href="../../../com/hazelcast/spi/FragmentedMigrationAwareService.html" title="interface in com.hazelcast.spi">FragmentedMigrationAwareService</a></dd>
</dl>
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../com/hazelcast/concurrent/atomiclong/AtomicLongService.html" title="class in com.hazelcast.concurrent.atomiclong">AtomicLongService</a>, <a href="../../../com/hazelcast/concurrent/atomicreference/AtomicReferenceService.html" title="class in com.hazelcast.concurrent.atomicreference">AtomicReferenceService</a>, <a href="../../../com/hazelcast/concurrent/countdownlatch/CountDownLatchService.html" title="class in com.hazelcast.concurrent.countdownlatch">CountDownLatchService</a>, <a href="../../../com/hazelcast/concurrent/lock/LockServiceImpl.html" title="class in com.hazelcast.concurrent.lock">LockServiceImpl</a>, <a href="../../../com/hazelcast/concurrent/semaphore/SemaphoreService.html" title="class in com.hazelcast.concurrent.semaphore">SemaphoreService</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">MigrationAwareService</span></pre>
<div class="block">An interface that can be implemented by SPI services to get notified of partition changes; for example, if a
 <a href="http://jet.hazelcast.org/hazelcast-jet/apidocs/com/hazelcast/map/impl.MapService.html?is-external=true" title="class or interface in com.hazelcast.map"><code>MapService</code></a> starts moving its data around because partitions are moving
 to a different machine.
 <p>
 Service itself must decide to keep or remove its data for specific partition according to number of backups
 it's willing to keep and <code>PartitionMigrationEvent</code> parameters; partitionId, migration-endpoint,
 current replica index and new replica index.
 <ul>
 <li>Migration endpoint shows which endpoint this member is; either <code>SOURCE</code> or <code>DESTINATION</code> </li>
 <li>Current replica index denotes the replica index which is currently owned by this member before migration.</li>
 <li>New replica index denotes the replica index which will be owned by this member after migration.</li>
 </ul>
 <p>
 On migration source, partition replica will be either removed completely or shifted down to a higher indexed replica.
 During commit, service should remove either all or some part of its data in this partition
 and run any other action needed. A sample commit on source will look like;
 <pre>
 <code>
 public void commitMigration(PartitionMigrationEvent event) {
     if (event.getMigrationEndpoint() == MigrationEndpoint.SOURCE) {
         if (event.getNewReplicaIndex() == -1 || event.getNewReplicaIndex() > configuredBackupCount) {
             // remove data...
         }
     }
     // run any other task needed
 }
 </code>
 </pre>
 During rollback, source usually doesn't expected to perform any task. But service implementation may need
 to execute custom tasks.
 <p>
 On migration destination, either a fresh partition replica will be received or current replica will be
 shifted up to a lower indexed replica.
 During rollback, service should remove either all or some part of its data in this partition
 and run any other action needed. A sample rollback on destination will look like;
 <pre>
 <code>
 public void rollbackMigration(PartitionMigrationEvent event) {
      if (event.getMigrationEndpoint() == MigrationEndpoint.DESTINATION) {
          if (event.getCurrentReplicaIndex() == -1 || event.getCurrentReplicaIndex() > configuredBackupCount) {
              // remove data...
          }
      }
     // run any other task needed
 }
 </code>
 </pre>
 <p>
 During commit, destination usually doesn't expected to perform any task. But service implementation may need
 to execute custom tasks.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/hazelcast/spi/MigrationAwareService.html#beforeMigration-com.hazelcast.spi.PartitionMigrationEvent-">beforeMigration</a></span>(<a href="../../../com/hazelcast/spi/PartitionMigrationEvent.html" title="class in com.hazelcast.spi">PartitionMigrationEvent</a>&nbsp;event)</code>
<div class="block">Called before migration process starts, on both source and destination members.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/hazelcast/spi/MigrationAwareService.html#commitMigration-com.hazelcast.spi.PartitionMigrationEvent-">commitMigration</a></span>(<a href="../../../com/hazelcast/spi/PartitionMigrationEvent.html" title="class in com.hazelcast.spi">PartitionMigrationEvent</a>&nbsp;event)</code>
<div class="block">Commits the migration process for this service, on both source and destination members.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="../../../com/hazelcast/spi/Operation.html" title="class in com.hazelcast.spi">Operation</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/hazelcast/spi/MigrationAwareService.html#prepareReplicationOperation-com.hazelcast.spi.PartitionReplicationEvent-">prepareReplicationOperation</a></span>(<a href="../../../com/hazelcast/spi/PartitionReplicationEvent.html" title="class in com.hazelcast.spi">PartitionReplicationEvent</a>&nbsp;event)</code>
<div class="block">Returns an operation to replicate service data and/or state for a specific partition replica
 on another cluster member.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/hazelcast/spi/MigrationAwareService.html#rollbackMigration-com.hazelcast.spi.PartitionMigrationEvent-">rollbackMigration</a></span>(<a href="../../../com/hazelcast/spi/PartitionMigrationEvent.html" title="class in com.hazelcast.spi">PartitionMigrationEvent</a>&nbsp;event)</code>
<div class="block">Rollback the migration process for this service, on both source and destination members.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="prepareReplicationOperation-com.hazelcast.spi.PartitionReplicationEvent-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareReplicationOperation</h4>
<pre><a href="../../../com/hazelcast/spi/Operation.html" title="class in com.hazelcast.spi">Operation</a>&nbsp;prepareReplicationOperation(<a href="../../../com/hazelcast/spi/PartitionReplicationEvent.html" title="class in com.hazelcast.spi">PartitionReplicationEvent</a>&nbsp;event)</pre>
<div class="block">Returns an operation to replicate service data and/or state for a specific partition replica
 on another cluster member.
 <p>
 This method will be called on source member whenever partitioning system requires
 to copy/replicate a partition replica. Returned operation will be executed on destination member.
 If operation fails by throwing exception, migration process will fail and will be rolled back.
 <p>
 Returning null is allowed and means service does not have anything to replicate.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>event</code> - replication</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>replication operation or null if nothing will be replicated</dd>
</dl>
</li>
</ul>
<a name="beforeMigration-com.hazelcast.spi.PartitionMigrationEvent-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>beforeMigration</h4>
<pre>void&nbsp;beforeMigration(<a href="../../../com/hazelcast/spi/PartitionMigrationEvent.html" title="class in com.hazelcast.spi">PartitionMigrationEvent</a>&nbsp;event)</pre>
<div class="block">Called before migration process starts, on both source and destination members.
 <p>
 Service can take actions required before migration. Migration process will block until this method returns.
 If this method fails by throwing an exception, migration process for specific partition will fail
 and will be rolled back.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>event</code> - migration event</dd>
</dl>
</li>
</ul>
<a name="commitMigration-com.hazelcast.spi.PartitionMigrationEvent-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>commitMigration</h4>
<pre>void&nbsp;commitMigration(<a href="../../../com/hazelcast/spi/PartitionMigrationEvent.html" title="class in com.hazelcast.spi">PartitionMigrationEvent</a>&nbsp;event)</pre>
<div class="block">Commits the migration process for this service, on both source and destination members.
 This method will be called after all replication operations are executed successfully on destination
 and master member receives success response from all participants.
 <p>
 Commit is not expected to fail at this point, all exceptions will be suppressed and logged.
 Implementations of this method must be thread safe as this method may be called concurrently
 for different migrations on different partitions.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>event</code> - migration event</dd>
</dl>
</li>
</ul>
<a name="rollbackMigration-com.hazelcast.spi.PartitionMigrationEvent-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>rollbackMigration</h4>
<pre>void&nbsp;rollbackMigration(<a href="../../../com/hazelcast/spi/PartitionMigrationEvent.html" title="class in com.hazelcast.spi">PartitionMigrationEvent</a>&nbsp;event)</pre>
<div class="block">Rollback the migration process for this service, on both source and destination members.
 This method will be called when migration process fails at any moment.
 Reasons for failure may be an exception thrown on any migration step
 or failure(s) of any of the migration participants; either master or source or destination.
 <p>
 Rollback is not expected to fail at this point, all exceptions will be suppressed and logged.
 Implementations of this method must be thread safe as this method may be called concurrently
 for different migrations on different partitions.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>event</code> - migration event</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MigrationAwareService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/hazelcast/spi/MembershipServiceEvent.html" title="class in com.hazelcast.spi"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../com/hazelcast/spi/NamedOperation.html" title="interface in com.hazelcast.spi"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/hazelcast/spi/MigrationAwareService.html" target="_top">Frames</a></li>
<li><a href="MigrationAwareService.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2020 <a href="http://www.hazelcast.com/">Hazelcast, Inc.</a>. All rights reserved.</small></p>
</body>
</html>
